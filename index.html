<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>絵合わせゲーム</title>
  <style>
    body { font-family: sans-serif; text-align: center; }
    #game { display: grid; grid-template-columns: repeat(4, 100px); grid-gap: 10px; justify-content: center; margin-top: 20px; }
    .card { width: 100px; height: 100px; cursor: pointer; }
    .card svg { width: 100%; height: 100%; }
    .front { display: none; }
    .back { fill: #cccccc; }
    .flipped .front { display: block; }
    .flipped .back { display: none; }
    #reset { margin-top: 20px; padding: 8px 16px; font-size: 16px; }
    #timer { margin-top: 10px; font-size: 18px; }
  </style>
</head>
<body>
  <h1>絵合わせゲーム</h1>
  <div id="game"></div>
  <p id="timer">経過時間: 00:00</p>
  <p id="message"></p>
  <button id="reset">リセット</button>
  <script>
    (function() {
      const svgNs = 'http://www.w3.org/2000/svg';
      const shapeSVGs = [
        '<circle cx="50" cy="50" r="30" fill="red" />',
        '<rect x="20" y="20" width="60" height="60" fill="blue" />',
        '<polygon points="50,15 90,85 10,85" fill="green" />',
        '<polygon points="50,10 61,38 90,38 66,59 76,90 50,72 24,90 34,59 10,38 39,38" fill="purple" />',
        '<ellipse cx="50" cy="50" rx="40" ry="25" fill="orange" />',
        '<line x1="20" y1="80" x2="80" y2="20" stroke="brown" stroke-width="8" />',
        '<path d="M10,90 Q50,10 90,90 Z" fill="pink" />',
        '<polygon points="50,10 90,50 50,90 10,50" fill="cyan" />'
      ];
      let flippedCards = [];
      let allowClick = true;
      let matchesFound = 0;
      const game = document.getElementById('game');
      const message = document.getElementById('message');
      const resetButton = document.getElementById('reset');
      let startTime, timerInterval;
      const timerElem = document.getElementById('timer');
      const TIME_LIMIT_MS = 40000; // 40秒の制限時間

      function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
      }
      function updateTimer() {
        const elapsed = Date.now() - startTime;
        if (elapsed >= TIME_LIMIT_MS) {
          timerElem.textContent = '経過時間: 00:40';
          clearInterval(timerInterval);
          allowClick = false;
          message.textContent = 'ゲームオーバー！時間切れです。';
          return;
        }
        const totalSeconds = Math.floor(elapsed / 1000);
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;
        timerElem.textContent = `経過時間: ${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
      }

      function initGame() {
        game.innerHTML = '';
        message.textContent = '';
        if (timerInterval) clearInterval(timerInterval);
        startTime = Date.now();
        timerElem.textContent = '経過時間: 00:00';
        timerInterval = setInterval(updateTimer, 1000);
        flippedCards = [];
        allowClick = true;
        matchesFound = 0;
        const cards = shapeSVGs.concat(shapeSVGs);
        shuffle(cards);
        cards.forEach(shapeSVG => {
          const card = document.createElement('div');
          card.classList.add('card');
          card.dataset.shape = shapeSVG;

          const front = document.createElementNS(svgNs, 'svg');
          front.classList.add('front');
          front.setAttribute('viewBox', '0 0 100 100');
          front.innerHTML = shapeSVG;

          const back = document.createElementNS(svgNs, 'svg');
          back.classList.add('back');
          back.setAttribute('viewBox', '0 0 100 100');
          back.innerHTML = '<rect x="0" y="0" width="100" height="100" />';

          card.appendChild(front);
          card.appendChild(back);
          card.addEventListener('click', onCardClick);
          game.appendChild(card);
        });
      }

      function onCardClick(e) {
        const card = e.currentTarget;
        if (!allowClick || card.classList.contains('flipped')) return;
        card.classList.add('flipped');
        flippedCards.push(card);
        if (flippedCards.length === 2) {
          allowClick = false;
          const [c1, c2] = flippedCards;
          if (c1.dataset.shape === c2.dataset.shape) {
            matchesFound++;
            flippedCards = [];
            allowClick = true;
            if (matchesFound === shapeSVGs.length) {
              message.textContent = 'おめでとう！全てのペアを見つけました！';
              clearInterval(timerInterval);
            }
          } else {
            setTimeout(() => {
              c1.classList.remove('flipped');
              c2.classList.remove('flipped');
              flippedCards = [];
              allowClick = true;
            }, 1000);
          }
        }
      }

      resetButton.addEventListener('click', initGame);
      initGame();
    })();
  </script>
</body>
</html>